function getCookies(e){let t={};for(const n of e.split("; "))keyVal=n.split("="),t[keyVal[0]]=keyVal[1];return t}!function(s){var o=s.document,i="mousedown mouseup mousemove mouseover mouseout mousewheel wheel",r="load unload beforeunload blur focus resize error abort online offline",e=(r+=" storage popstate hashchange pagehide pageshow message beforeprint afterprint",i=(i=i+" touchstart touchend touchmove deviceorientation keydown keyup keypress"+" click dblclick scroll change select submit reset contextmenu cut copy paste").split(" "),r=r.split(" "),i.concat(r)),n=0,a=0,t=[],l={settings:{postServer:"//my.server.org/save.script",postInterval:30,regularEvents:"*",pollingEvents:"",pollingMs:150,taskName:"evtrack",callback:null,saveAttributes:!0,debug:!1,cookieExpiry:365},record:function(e){for(var t in a=(new Date).getTime(),l.settings)e.hasOwnProperty(t)&&null!==e[t]&&(l.settings[t]=e[t]);l.addEventListeners(),l.socket=io.connect(l.settings.postServer),l.socket.on("connect",()=>{}),l.socket.on("auth",t=>{if(getCookies(o.cookie).id)n=getCookies(o.cookie).id;else{let e=new Date;e.setTime(e.getTime()+24*l.settings.cookieExpiry*60*60*1e3),o.cookie=`id=${t.id};path=/;expires=`+e.toGMTString(),n=t.id}}),setInterval(function(){l.appendData()},1e3*l.settings.postInterval)},addEventListeners:function(){"*"==l.settings.regularEvents?l.addCustomEventListeners(e):(l.log("Settings regular events..."),l.settings.regularEvents=l.settings.regularEvents.split(" "),l.addCustomEventListeners(l.settings.regularEvents)),"*"==l.settings.pollingEvents?l.addCustomEventListeners(e):(l.log("Settings polling events..."),l.settings.pollingEvents=l.settings.pollingEvents.split(" "),l.addCustomEventListeners(l.settings.pollingEvents)),TrackLib.Events.add(s,"beforeunload",l.flush),TrackLib.Events.add(s,"unload",l.flush)},addCustomEventListeners:function(e){l.log("Adding event listeners:",e);for(var t=0;t<e.length;++t){var n=e[t];n&&(-1<i.indexOf(n)?(TrackLib.Events.add(o,n,l.docHandler),l.log("Adding document event:",n),o.attachEvent&&("focus"==n&&TrackLib.Events.add(o.body,"focusin",l.winHandler),"blur"==n&&TrackLib.Events.add(o.body,"focusout",l.winHandler))):-1<r.indexOf(n)&&(TrackLib.Events.add(s,n,l.winHandler),l.log("Adding window event:",n)))}},setUserId:function(e){n=e.responseText,l.log("setUserId:",n),n&&setInterval(function(){l.appendData()},1e3*l.settings.postInterval)},appendData:function(){var e={uid:n,info:encodeURIComponent(t.join("|||")),action:"append",url:s.location.href};0<t.length?l.socket.emit("data",e):l.log("Skipping empty request..."),t=[]},send:function(e){e.url=l.settings.postServer,TrackLib.XHR.sendAjaxRequest(e)},docHandler:function(e){-1<e.type.indexOf("touch")?l.touchHandler(e):l.eventHandler(e)},winHandler:function(e){l.eventHandler(e)},eventHandler:function(e){e=TrackLib.Events.fix(e);var t,n,s,o=(new Date).getTime(),i=e.type,r=!0;(r=0<l.settings.pollingMs&&-1<l.settings.pollingEvents.indexOf(i)?o-a>=l.settings.pollingMs:r)&&(r=l.getMousePos(e),t=TrackLib.XPath.getXPath(e.target),n=l.settings.saveAttributes?TrackLib.Util.serializeAttrs(e.target):"{}",s="isTrusted"in e?JSON.stringify({trusted:e.isTrusted}):"{}",l.fillInfo(e.id,o,r.x,r.y,i,t,n,s),a=o)},touchHandler:function(e){if(!("isTrusted"in(e=TrackLib.Events.fix(e)))||e.isTrusted){var t=e.changedTouches;if(t)for(var n,s=0;s<t.length;++s)(n=t[s]).type=e.type,l.eventHandler(n)}},getMousePos:function(e){var t=0,n=0;return(e=TrackLib.Events.fix(e)).pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+o.body.scrollLeft+o.documentElement.scrollLeft,n=e.clientY+o.body.scrollTop+o.documentElement.scrollTop),{x:t=!t||t<0?0:t,y:n=!n||n<0?0:n}},fillInfo:function(e){e=[].slice.apply(arguments);t.push(e.join(" ")),l.log(e)},flush:function(e){var t;for(l.log("Flushing data..."),t=0;t<i.length;++t)TrackLib.Events.remove(o,i[t],l.docHandler);for(t=0;t<r.length;++t)TrackLib.Events.remove(s,r[t],l.winHandler);n&&l.appendData()},log:function(e){l.settings.debug&&"function"==typeof console.log&&console.log.apply(console,arguments)}};s.TrackUI=l}(this);
